<%content_for :titulo do%>
Contratos Administrativos

<div class="input-group col-md-4 pull-right">
  <%= search_form_for @q,:url=>contratos_index_url do |f|%>

  <div class="input-group">
    <%= f.search_field :nome_or_cpf_or_rg_or_funcionarios_matricula_or_lotacoes_codigo_barra_cont,:class=>"form-control input-lg"%>
    <div class="input-group-btn">
      <%= button_tag(type: 'submit', class: "btn btn-info btn-lg") do %>
      <span class="glyphicon glyphicon-search"></span>
      <% end %>
    </div>
  </div>
</div>
<%end%>
<%= link_to "Criar",contratos_pessoal_path,:class=>"btn btn-primary" if can?(:create,Contrato)%>&nbsp;&nbsp;&nbsp;<%=link_to "Estatísticas",contratos_estatisticas_path,:class=>"btn btn-primary"%>
<%end%>
<table class="table table-striped tabela-colapsavel">
  <thead>
    <tr>
      <th>NOME</th>
      <th>CPF</th>
      <th>RG</th>
      <th>NASCIMENTO</th>
      <th>CRIADO EM</th>
      <th>Nº DE FUNC.</th>
      <th>AÇÕES</th>
    </tr>
  </thead>
  <tbody>
    <%@pessoas.each_with_index do |p,i|%>
    <tr class="accordion-toggle">
      <td data-toggle="collapse" data-target="#demo<%=i%>" style="cursor: pointer;"><%= p.nome%></td>
      <td data-toggle="collapse" data-target="#demo<%=i%>" style="cursor: pointer;" ><%= p.cpf%></td>
      <td data-toggle="collapse" data-target="#demo<%=i%>" style="cursor: pointer;" ><%= p.rg%></td>
      <td data-toggle="collapse" data-target="#demo<%=i%>" style="cursor: pointer;" ><%= p.nascimento.to_s_br%></td>
      <td data-toggle="collapse" data-target="#demo<%=i%>" style="cursor: pointer;" ><%= p.created_at.strftime("%d/%m/%Y %H:%M")%></td>
      <td data-toggle="collapse" data-target="#demo<%=i%>" style="cursor: pointer;" ><span class="badge"><%= p.funcionarios.count%></span></td>
      <td>
        <div class="btn-group">
          <button class="btn btn-default btn-xs dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Escolha <span class="caret"></span>
          </button>
          <ul class="dropdown-menu dropdown-menu-right">
            <li><%#= link_to "<i class='fa fa-users fa-fw'></i> Funcionários".html_safe,pessoa_funcionarios_path(p),:class=>"btn btn-primary btn-xs" if can? :read,Funcionario%></li>
            <% if can? :update,Pessoa %>
            <li><%= link_to "<i class='fa fa-edit fa-fw'></i> Editar".html_safe, contratos_editar_path(:pessoa_id=>p.id) %></li>
            <% end %>
            <li><%= link_to "<i class='fa fa-eye fa-fw'></i> Visualizar".html_safe, contratos_detalhes_path(:pessoa_id=>p.id) %></li>
            <% if can? :destroy,Pessoa %>
            <li><%= link_to "Apagar", contratos_apagar_path(:pessoa_id=>p),:class=>"btn btn-danger btn-xs",:method=>:delete,:confirm=>"Tem Certeza?" %></li>
            <% end %>
          </ul>
        </div>
      </td>
    </tr>
    <tr>
      <td colspan="10" class="hiddenRow">
        <div class="accordion-body collapse" id="demo<%=i%>">
         <br/>
         <% p.funcionarios.each.with_index(1) do |f,i|%>
         <div class="well">
          <div class="row">
            <div class="col-xs-2">
              <dt>MATRÍCULA:</dt>
              <dd><%= detalhes(f.matricula)%></dd>
            </div>
            <div class="col-xs-5">
              <dt>CARGO:</dt>
              <dd><%= cargo_disciplina(f) %></dd>
            </div>
            <div class="col-xs-3">
              <dt>CATEGORIA:</dt>
              <dd><%= categoria_funcional(f,"entidade_sigla") %></dd>
            </div>
            <div class="col-xs-2">
              <dt></dt>
              <dd>
                <div class="btn-group">
                  <button class="btn btn-default btn-xs dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Mais opções<span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu dropdown-menu-right">
                    <% if can? :update,Funcionario and  can? :edit,Funcionario %>
                    <li><%= link_to "<i class='fa fa-edit fa-fw'></i> Editar".html_safe,edit_pessoa_funcionario_path(p,f) %></li>
                    <% end %>
                    <% if can? :read,Lotacao %>
                    <li><%= link_to "<i class='fa fa-exchange fa-fw'></i> Lotações".html_safe,pessoa_funcionario_lotacoes_path(p,f) %></li>
                    <% end %>
                  </ul>
                </div>
              </dd>
            </div>
          </div>
          <br/>
          <div class="row">
            <div class="col-xs-2">
              <dt>ADMISSÃO:</dt>
              <dd><%=f.data_nomeacao.to_s_br%></dd>
            </div>
            <div class="col-xs-5">
              <dt>LOTAÇÃO:</dt>
              <dd><%= lotacao_detalhes(f,"ativa_detalhada") %></dd>
            </div>
            <div class="col-xs-4">
              <!-- <dt>QUADRO:</dt>
              <dd><%#=detalhes(f.entidade)%></dd> -->
              <dt>SITUAÇÃO:</dt>
              <dd><%=situacao(f)%></dd>
            </div>
          </div>
          <br/>
          <br/>
        </div>

        <% end %>

      </div>
    </td>
  </tr>
  <% end%>
</tbody>
</table>
<div align="center"><%=will_paginate @pessoas%></div>
